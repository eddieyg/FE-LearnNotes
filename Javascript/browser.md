# 浏览器
about browser...

## 页面渲染路径
  - HTML DOM 解析
    - 解析遇到 `<script>` 标签加载并执行（期间阻塞DOM后续的解析）；如标签有`async`属性，则异步加载后再执行（执行期间会阻塞）；如标签有`defer`属性，则异步加载后在DOM解析完后执行；并且 `css` 模型的解析也会阻塞 DOM解析
    - 没有解析到 `<script>` 则 `css` 模型的解析不会阻塞 DOM解析
  - Css 模型解析
  - DOM模型和css模型结合组成渲染树
  - 根据渲染树`布局`位置和大小
  - 根据渲染树`绘制`成屏幕上的像素

## 事件循环(Event Loop)
`javascript`是单线程执行的，在浏览器页面进程中的，js引擎线程负责`javascript`代码的解析运行。  
js引擎线程由堆（存放变量的内存）、执行栈（运行代码）、任务队列（异步回调函数）组成。  
js引擎线程与GUI渲染线程是互斥的，执行栈会阻塞渲染线程，渲染线程执行的时候执行栈会被挂起。

### 同步与异步
js代码分为同步任务和异步任务；其中异步任务又分为宏任务和微任务
- 宏任务：setTimeout、setInterval、事件监听器、Ajax
- 微任务：Promise、MutationObserver
- 特殊的异步：requestAnimationFrame回调函数在GUI渲染之前执行


### 事件循环顺序
执行栈清空 - 微任务队列清空 - rAF回调执行（如果遇上渲染） - 宏任务队列推一个进执行栈 - Loop  
- 执行栈清空：执行栈依次按照顺序运行同步任务；遇到异步任务会交给对应的其他线程（定时器线程、事件监听线程、ajax请求线程等），其他线程完成后将回调函数推进`任务队列`
- 微任务队列清空：任务队列的所有微任务推进执行栈运行，如果期间又产生了微任务，再次推进执行栈清空
- rAF回调执行：如果有被挂起的渲染操作，在渲染之前执行requestAnimationFrame回调函数
- 宏任务队列：每次推一个宏任务进执行栈运行
- 循环以上执行栈清空操作